---
title: "네트워크 기본 상식"
date: 2021-02-05
author: loopy
---
## Basics

### Public/Private IP

인터넷에 접속하려면 IP 주소가 필요하고, 이 IP 주소는 전세계에서 Unique 해야한다. 이를 Public IP(공인 IP)라고 한다.
하지만 전세계의 모든 사람들이 공인 IP를 써야한다면, IP 주소는 이미 벌써 고갈되었을 것이다. 게다가 Public IP를 부여받는 과정은 생각보다 그리 간단하지 않다. 그래서 보통 실무에서는 인터넷에 연결하지 않고 개별적으로 구성한 네트워크 망에서 Private IP(사설 IP)를 이용해 통신한다. 인터넷에 접속할 필요가 있다면 NAT(Network Address Translation) 기술을 이용하여 Private IP를 Public IP로 변환하여 사용한다. 대표적인 예시로 집안의 모든 전자기기들이 인터넷에 접속할 수 있도록 도와주는 가정용 공유기(iptime등)가 NAT 장비의 예이다.

> cf. AWS 에서는 Elastic IP(EIP)에서 IP를 부여한다.

### TCP/UDP

IP로 이제 어디로 찾아가야하는지 주소를 확인했다면, 어떤식으로 데이터를 전송할지에 대한 규약이다. 

TCP는 패킷에 순서(Seq)와 응답번호(Ack)를 부여하여, 패킷의 손실을 방지한다. 윈도우와 슬라이딩 윈도우 개념을 도입하여 N개(size of window)의 패킷을 전송한 후 메모리에 유지하다가 ACK 번호를 받은 후 통신이 잘 된 상황을 파악하고 나서 메모리에서 데이터를 제거한다. 중간에 유실이 있으면 SEQ와 ACK 번호를 비교하여 파악하고 메모리에 유지한 데이터를 이용하여 재전송을 수행한다. 슬라이딩 윈도우란, 네트워크가 안정된 상태에서는 윈도우의 크기를 증가시키고, Congestion이 발생하면 윈도우의 크기를 줄여서 안정성을 높힌다.

또한, Connection 맺기 전 사전 연결 작업을 진행한다. 3번의 패킷을 주고받으며 통신을 준비하므로 3-way handshake라고 불리는데 다음과 같다.

![3-way-handshake](https://s3.ap-south-1.amazonaws.com/afteracademy-server-uploads/what-is-a-tcp-3-way-handshake-process-three-way-handshaking-terminating-connection-6ea4a4c72d165361.jpg)

즉, 데이터를 안전하게 주고 받을 수 있는 상황인지 확인하는 작업이다.

반면 UDP는 위와 같은 데이터 전송의 신뢰성 확보 관련 절차가 거의 없다. 일부 데이터가 유실되더라도 시간에 맞추어 계속 전송하는 것이 중요한 일부 음성/영상 스트리밍 서비스에서는 UDP를 사용한다.

예를 들어, 넷플릭스 유투브 와 같이 미리 사전제작된 동영상을 단일 사용자에게 제공하는 플랫폼에서는 동영상을 미리 캐싱해 두고 높은 품질로 제공하기 때문에 TCP를 사용하고, 반면에 실시간 화상회의 솔루션같이 여러명의 사용자가 양방향으로 데이터를 전송하고 시간에 민감한(데이터 유실로 재전송시 끊김 현상) 경우에는 UDP를 사용한다.

### NAT

Network Address Translation의 약자로 말그대로 네트워크 주소를 변환해주는 것이다. "IP 주소를 다른 IP 주소로 변환해 라우팅을 원활히 해주는 기술"이라고 인터넷 표준에선 정의하고 있다. 사설 IP에서 공인 IP로 전환하는 경우가 NAT 기술을 가장 많이 사용하는 경우이다.

#### why use NAT

- ipv4 고갈
인터넷에 연결되는 기기의 수가 폭증함에 따라 IP 주소는 점점 고갈되었다. 이 문제에 대해 단/중/장기 솔루션이 제시되었는데, 단기적으로는 subnet을 이용하여 IP 주소를 효율적으로 사용하는 것이고, 중기적으로는 NAT와 사설 IP를 이용하여 외부에 공개해야 하는 서비스에 대해서는 공인 IP를 사용하고 외부에 공개할 필요없는 내부 서비스나 개인 사용자의 PC, 기타 End Device 들의 경우에는 사설 IP를 사용하도록 하여 효율성을 높였다. 장기적인 해결책은 ipv6 전환일 것이다.
- 보안
외부와 통신할때 내부 IP를 다른 IP로 변환하여 통신하면 사내 IP 체계를 숨길 수 있고 보안을 쉽게 강화할 수 있다.

### DNS

DNS는 도메인 주소를 IP 주소로 변환하는 역할을 한다. 사용자가 도메인을 입력하면, 브라우저는 DNS 서버에 도메인을 쿼리(질의)하고 DNS 서버는 해당 도메인의 IP 주소를 찾아 응답한다. 그리고 브라우저는 해당 IP에 접속하게 된다. 물론 DNS 에 쿼리 전 로컬 캐시를 뒤져서 저장되어있지 않을때 DNS에 쿼리를 진행한다.

#### Records

AWS에서는 Route53이라는 서비스에서 DNS 설정을 입력할 수 있는데, 이때 알아두면 유용한 레코드들을 메모한다

A: A레코드는 가장 기본적인 레코드로 도메인 주소를 IP 주소로 변환하는 레코드이다. 하나의 레코드에는 한개의 도메인주소와 IP 주소가 1:1로 매핑되는데, 여러개의 도메인주소와 한개의 IP 주소, 또는 그 반대로 여러개의 IP 주소와 한개의 도메인 주소를 매핑할때는 여러개의 A레코드를 입력하면 된다.

CNAME: Canonical Name 으로 말 그대로 별칭(alias)이다. 즉, 다른 도메인 주소를 매핑한다. 실제로 가장 많이 쓰이는 레코드로, 간단한 예시로는 www.naver.com 을 naver.com CNAME으로 등록하는 예시가 있고, 여러 서비스를 운영하는 회사에서 {service1}.{corporate-domain}.com 으로 요청이 들어왔을때 중앙에 있는 {APIGW_HOST}로 CNAME을 걸어두는 예시가 가능하다.

| Record            | Type         | Value             |
|-------------------|--------------|-------------------|
| www.naver.com     | CNAME        | naver.com         |
| {service1}.com    | CNAME        | {APIGW_HOST}      |
| {service2}.com    | CNAME        | {APIGW_HOST}      |

SOA: 필수 항목으로 도메인 영역 권한 및 도메인 관리에 필요한 속성값을 정의한다(네임서버, 관리자 정보, TTL등).

NS: 도메인에 대한 권한이 있는 네임 서버 정보를 설정하는 레코드이다.
